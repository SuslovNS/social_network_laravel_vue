import{_ as c,o as n,c as h,e as t,t as o,F as u,a as l,f as p,i as m,v as _,n as d,p as g,j as I}from"./app.061de71c.js";const v={name:"User.vue",data(){return{user:{},userGet:{},messages:[],messageInput:"",userId:this.$route.params.userId,userSentId:"",channelId:""}},methods:{sendMessage(){axios.post(`/api/chat/${this.userId}/send`,{message:this.messageInput,sendUserId:this.user.id}).then(e=>{this.messageInput="",this.messages.push(e.data.data)})},getMessages(){axios.get(`/api/chat/${this.userId}`).then(e=>{this.messages=e.data.data,this.user=this.$route.meta.user})},getUserGet(){axios.get(`/api/users/get/${this.userId}`).then(e=>{this.userGet=e.data.data})},getChannelId(e,a){return e<a?`${e}-${a}`:`${a}-${e}`},async openChannel(){let a=(await axios.get("/api/user")).data.id;this.userSentId=a.toString(),this.channelId=this.getChannelId(this.userId,this.userSentId)},open(){if(!this.channelId)return setTimeout(this.open,100);window.Echo.channel(`chat.${this.channelId}`).listen(".store_message",e=>{this.messages.push(e.message)})}},mounted(){this.getUserGet(),this.getMessages(),this.openChannel(),this.open()}},x=e=>(g("data-v-ab8a0d90"),e=e(),I(),e),f={class:"chat"},y={class:"empty-chat"},S={class:"chat-body"},b={key:0},w={class:"chat-messages"},M={class:"chat-message"},U={key:1,class:"empty-chat"},C={class:"chat-footer"},G=x(()=>t("button",{type:"submit"},"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C",-1));function k(e,a,B,D,s,r){return n(),h("div",f,[t("div",y,[t("h3",null,"Chat with "+o(s.userGet.name),1)]),t("div",S,[s.messages.length>0?(n(),h("div",b,[t("div",w,[(n(!0),h(u,null,l(s.messages,i=>(n(),h("div",M,[t("div",{class:d(["chat-message-user",i.sent_id===s.user.id?"text-right":"text-left"])},o(i.sent_id===s.user.id?s.user.name:s.userGet.name),3),t("div",{class:d(["chat-message-text",i.sent_id===s.user.id?"text-right":"text-left"])},o(i.body),3),t("div",{class:d(["chat-message-timestamp",i.sent_id===s.user.id?"text-right":"text-left"])},o(i.time),3)]))),256))])])):(n(),h("div",U," No messages "))]),t("div",C,[t("form",{onSubmit:a[1]||(a[1]=p((...i)=>r.sendMessage&&r.sendMessage(...i),["prevent"]))},[m(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=i=>s.messageInput=i),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435"},null,512),[[_,s.messageInput]]),G],32)])])}const F=c(v,[["render",k],["__scopeId","data-v-ab8a0d90"]]);export{F as default};
